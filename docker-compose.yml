services:
  ollama:
    image: ollama/ollama:latest
    container_name: beatrice-ollama
    ports:
      - "11434:11434"
    volumes:
      - ./data/ollama:/root/.ollama
    restart: unless-stopped

  chromadb:
    image: chromadb/chroma:latest
    container_name: beatrice-chroma
    ports:
      - "8000:8000"
    volumes:
      - ./data/chroma:/chroma/data
    environment:
      - IS_PERSISTENT=TRUE
    restart: unless-stopped

  tts:
    build:
      context: .
      dockerfile: Dockerfile.voice
    container_name: beatrice-tts
    volumes:
      - .:/app
      - ./data/tts:/app/data
    environment:
      - PIPER_MODEL=/app/data/models/en_US-lessac-medium.onnx
    command: python src/voice/tts_service.py
    restart: unless-stopped

  stt:
    build:
      context: .
      dockerfile: Dockerfile.voice
    container_name: beatrice-stt
    volumes:
      - .:/app
      - ./data/stt:/app/data
    command: python src/voice/stt_service.py
    restart: unless-stopped

  # Main Orchestrator
  core:
    build:
      context: .
      dockerfile: Dockerfile.core
    container_name: beatrice-core
    volumes:
      - .:/app
    environment:
      - OLLAMA_HOST=http://beatrice-ollama:11434
      - CHROMA_HOST=http://beatrice-chroma:8000
    command: tail -f /dev/null # Keep alive for interaction
    depends_on:
      - ollama
      - chromadb
    restart: unless-stopped
